<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-eq        .table-body-container::-webkit-scrollbar {
            width: 6px;
        }

        .table-body-container::-webkit-scrollbar-track {
            background: rgba(55, 0, 60, 0.3);
            border-radius: 3px;
        }

        .table-body-container::-webkit-scrollbar-thumb {
            background: #00ff87;
            border-radius: 3px;
        }

        .table-body-container::-webkit-scrollbar-thumb:hover {
            background: #00cc6a;
        }

        /* Add padding to header to account for scrollbar */
        .table-header {
            padding-right: 6px;
        }ent="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="description" content="Fantasy Football League Dashboard - Team rankings, player stats, and weekly analysis">
    <meta name="keywords" content="fantasy football, premier league, FPL, football statistics, team rankings">
    <title>Fantasy Football League</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #37003c 0%, #00ff87 100%);
            color: white;
            line-height: 1.6;
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .main-content {
            display: flex;
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
            align-items: flex-start;
            height: calc(100vh - 30px);
            justify-content: center;
        }

        .left-column, .right-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .left-column {
            max-width: 500px;
        }

        .right-column {
            max-width: 600px;
        }

        .column {
            background: rgba(55, 0, 60, 0.8);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 135, 0.3);
            box-shadow: 0 8px 32px rgba(55, 0, 60, 0.3);
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 500px;
        }

        .title-section h1 {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 25px;
            color: #00ff87;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-weight: bold;
        }

                .newspaper-placeholder {
            width: 100%;
            border-radius: 8px;
            margin-top: 20px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .newspaper-placeholder img {
            width: 100%;
            height: auto;
            display: block;
        }

        .table-section h2 {
            margin-bottom: 15px;
            font-size: 1.6rem;
            text-align: center;
            border-bottom: 2px solid #00ff87;
            padding-bottom: 8px;
            color: #00ff87;
        }

        .table-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .table-container {
            flex: 1;
            height: calc(500px - 40px - 20px);
            margin-top: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .table-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .table-header {
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .league-table, .league-table-body {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 0;
            font-size: 0.85rem;
            table-layout: fixed;
        }

        .league-table th:nth-child(1),
        .league-table-body td:nth-child(1) { width: 8%; } /* Pos */
        
        .league-table th:nth-child(2),
        .league-table-body td:nth-child(2) { width: 32%; } /* Manager */
        
        .league-table th:nth-child(3),
        .league-table-body td:nth-child(3) { width: 35%; } /* Team Name */
        
        .league-table th:nth-child(4),
        .league-table-body td:nth-child(4) { width: 12%; } /* GW */
        
        .league-table th:nth-child(5),
        .league-table-body td:nth-child(5) { width: 13%; } /* Total */

        .table-body-container {
            flex: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #00ff87 rgba(55, 0, 60, 0.3);
        }

        .table-container::-webkit-scrollbar {
            width: 6px;
        }

        .table-container::-webkit-scrollbar-track {
            background: rgba(55, 0, 60, 0.3);
            border-radius: 3px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: #00ff87;
            border-radius: 3px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: #00cc6a;
        }

        .loading-message, .error-message {
            text-align: center;
            padding: 10px;
            font-size: 0.9rem;
            color: #00ff87;
            margin: 0;
        }

        .error-message {
            color: #ff6b6b;
        }

        .position-movement {
            font-size: 0.7rem;
            margin-left: 3px;
        }

        .movement-up {
            color: #00ff87;
        }

        .movement-down {
            color: #ff6b6b;
        }

        .movement-same {
            color: #999;
        }

        .position-1 { color: #FFD700; font-weight: bold; background: rgba(255, 215, 0, 0.15) !important; }
        .position-2 { color: #C0C0C0; font-weight: bold; background: rgba(192, 192, 192, 0.15) !important; }
        .position-3 { color: #CD7F32; font-weight: bold; background: rgba(205, 127, 50, 0.15) !important; }

        .league-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 0;
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .league-table th,
        .league-table-body td {
            padding: 4px 6px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 255, 135, 0.2);
        }

        .league-table th {
            background: #37003c;
            font-weight: bold;
            color: #00ff87;
            font-size: 0.8rem;
            border-bottom: 2px solid #00ff87;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .league-table-body td {
            background: rgba(255, 255, 255, 0.02);
        }        .league-table tr:hover {
            background: rgba(0, 255, 135, 0.1);
        }

        .league-table tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.1);
        }

        .position-1 { color: #FFD700; font-weight: bold; }
        .position-2 { color: #C0C0C0; font-weight: bold; }
        .position-3 { color: #CD7F32; font-weight: bold; }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .main-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .left-column, .right-column {
                max-width: 100%;
            }
            
            .title-section h1 {
                font-size: 1.8rem;
            }
            
            .newspaper-placeholder {
                height: 250px;
                font-size: 1rem;
            }
            
            .league-table {
                font-size: 0.8rem;
            }
            
            .league-table th,
            .league-table td {
                padding: 3px 4px;
            }
            
            .position-movement {
                font-size: 0.65rem;
            }
        }
    </style>
</head>

<body>
    <main id="main-content" class="main-content">
        <!-- Left Column: Title and Newspaper Placeholder -->
        <div class="left-column">
            <div class="column">
                <div class="title-section">
                    <h1>âš½ Fantasy Premier League</h1>
                </div>
                <div class="newspaper-placeholder">
                    <img src="../assets/images/Runde 5.png" alt="Runde 5 Nyhetsbrev" />
                </div>
            </div>
        </div>

        <!-- Right Column: League Table -->
        <div class="right-column">
            <div class="column">
                                <div class="table-section">
                    <div id="loading" class="loading-message">
                        <p>Loading league data...</p>
                    </div>
                    
                    <div id="error" class="error-message" style="display: none;">
                        <p>Unable to load league data. Please try again later.</p>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-wrapper">
                            <table class="league-table" id="leagueTable" style="display: none;">
                                <thead class="table-header">
                                    <tr>
                                        <th>Pos</th>
                                        <th>Manager</th>
                                        <th>Team Name</th>
                                        <th>GW</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                            </table>
                            <div class="table-body-container">
                                <table class="league-table-body">
                                    <tbody id="leagueTableBody">
                                        <!-- Table rows will be inserted here by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Fantasy Premier League API endpoints
        const LEAGUE_ID = 1509278;
        const FPL_API_BASE = 'https://fantasy.premierleague.com/api';
        
        // Proxy service to handle CORS (trying different proxies)
        const CORS_PROXIES = [
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?',
            'https://cors-anywhere.herokuapp.com/'
        ];
        let currentProxyIndex = 0;

        // Function to try different CORS proxies
        async function fetchWithProxy(url, proxyIndex = 0) {
            if (proxyIndex >= CORS_PROXIES.length) {
                throw new Error('All CORS proxies failed');
            }
            
            try {
                const proxy = CORS_PROXIES[proxyIndex];
                const proxyUrl = `${proxy}${encodeURIComponent(url)}`;
                console.log(`Trying proxy ${proxyIndex + 1}: ${proxy}`);
                
                const response = await fetch(proxyUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.log(`Proxy ${proxyIndex + 1} failed:`, error);
                return fetchWithProxy(url, proxyIndex + 1);
            }
        }

        // Auto-scroll function for the table
        let scrollInterval;
        function startAutoScroll() {
            console.log('Starting auto-scroll...');
            const tableContainer = document.querySelector('.table-body-container');
            if (!tableContainer) {
                console.log('Table body container not found');
                return;
            }
            
            console.log('Container height:', tableContainer.clientHeight, 'Scroll height:', tableContainer.scrollHeight);
            
            // Clear any existing interval
            if (scrollInterval) {
                clearInterval(scrollInterval);
            }
            
            // Check if scrolling is needed
            if (tableContainer.scrollHeight <= tableContainer.clientHeight) {
                console.log('No overflow detected, auto-scroll not needed');
                return; // No overflow, no need to scroll
            }
            
            console.log('Starting auto-scroll with 5-second initial delay');
            let initialDelayCounter = 100; // 5 seconds at 50ms intervals
            let pauseCounter = 0;
            let isAtBottom = false;
            const pauseDuration = 100; // Pause for 5 seconds at bottom before reset
            
            scrollInterval = setInterval(() => {
                // Initial 5-second delay before starting to scroll
                if (initialDelayCounter > 0) {
                    initialDelayCounter--;
                    return;
                }
                
                // Pause at bottom before reset
                if (pauseCounter > 0) {
                    pauseCounter--;
                    if (pauseCounter === 0 && isAtBottom) {
                        // Reset to top after pause is complete
                        tableContainer.scrollTop = 0;
                        isAtBottom = false;
                        initialDelayCounter = 100; // Reset 5-second delay for next cycle
                        console.log('Pause complete, reset to top - starting new 5-second delay');
                    }
                    return;
                }
                
                const scrollStep = 1;
                const currentScroll = tableContainer.scrollTop;
                const maxScroll = Math.max(0, tableContainer.scrollHeight - tableContainer.clientHeight);
                
                // Only scroll down
                if (currentScroll >= maxScroll && !isAtBottom) {
                    // Reached bottom - start pause counter
                    isAtBottom = true;
                    pauseCounter = pauseDuration;
                    console.log('Reached bottom, starting 5-second pause...');
                } else if (!isAtBottom) {
                    tableContainer.scrollTop += scrollStep;
                }
            }, 50); // 50ms intervals for smooth movement
        }

        // Function to fetch league standings
        async function fetchLeagueStandings() {
            try {
                console.log('Fetching league standings...');
                const data = await fetchWithProxy(`${FPL_API_BASE}/leagues-classic/${LEAGUE_ID}/standings/`);
                console.log('League data received:', data);
                
                displayLeagueTable(data.standings.results);
                
            } catch (error) {
                console.error('Error fetching league data:', error);
                showError();
            }
        }

        // Function to display the league table
        function displayLeagueTable(standings) {
            const tableBody = document.getElementById('leagueTableBody');
            const loadingElement = document.getElementById('loading');
            const tableElement = document.getElementById('leagueTable');
            
            // Hide loading message
            loadingElement.style.display = 'none';
            
            // Clear existing data
            tableBody.innerHTML = '';
            
            // Add standings data
            standings.forEach((team, index) => {
                const row = document.createElement('tr');
                
                // Add position-based styling
                if (index === 0) row.classList.add('position-1');
                else if (index === 1) row.classList.add('position-2');
                else if (index === 2) row.classList.add('position-3');
                
                // Calculate position movement
                let movementIndicator = '';
                if (team.last_rank && team.rank !== team.last_rank) {
                    const movement = team.last_rank - team.rank;
                    if (movement > 0) {
                        movementIndicator = `<span class="position-movement movement-up">â†‘${movement}</span>`;
                    } else {
                        movementIndicator = `<span class="position-movement movement-down">â†“${Math.abs(movement)}</span>`;
                    }
                } else if (team.last_rank) {
                    movementIndicator = `<span class="position-movement movement-same">-</span>`;
                }
                
                row.innerHTML = `
                    <td>${team.rank}${movementIndicator}</td>
                    <td>${team.player_name}</td>
                    <td>${team.entry_name}</td>
                    <td>${team.event_total}</td>
                    <td>${team.total.toLocaleString()}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Show the tables
            tableElement.style.display = 'table';
            document.querySelector('.table-body-container').style.display = 'block';
            
            // Start auto-scroll after a short delay to ensure table is rendered
            setTimeout(() => {
                startAutoScroll();
            }, 1000);
        }

        // Function to show error message
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, fetching FPL data...');
            
            // Fetch league data only
            fetchLeagueStandings();
            
            // Set up auto-refresh every 5 minutes
            setInterval(() => {
                console.log('Refreshing league data...');
                fetchLeagueStandings();
            }, 300000);
        });
    </script>
</body>

</html>
